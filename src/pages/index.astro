---
import Layout from '../layouts/Layout.astro'
import Sidebar from '../components/Sidebar'
import Generator from '../components/Generator'
import NoteCanvas from '../components/NoteCanvas'
import '../message.css'
import '../canvas.css'
import 'katex/dist/katex.min.css'
import 'highlight.js/styles/atom-one-dark.css'
---

<Layout title="Gemini Pro Chat">
  <Sidebar client:load />
  <main class="app-content">
    <div class="chat-panel">
      <Generator client:load />
    </div>
    <div class="canvas-panel" id="canvasPanel">
      <NoteCanvas client:load />
    </div>
  </main>
  <!-- Mobile tab bar -->
  <div class="mobile-tab-bar">
    <button class="mobile-tab-btn active" id="tabChat">Chat</button>
    <button class="mobile-tab-btn" id="tabCanvas">Notes</button>
  </div>
</Layout>

<script>
async function checkCurrentAuth() {
  const password = localStorage.getItem('pass')
  const response = await fetch('/api/auth', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      pass: password,
    }),
  })
  const responseJson = await response.json()
  if (responseJson.code !== 0)
    window.location.href = '/password'
}
checkCurrentAuth()

// Mobile tab bar logic
const tabChat = document.getElementById('tabChat')
const tabCanvas = document.getElementById('tabCanvas')
const appContent = document.querySelector('.app-content')

tabChat?.addEventListener('click', () => {
  appContent?.classList.remove('canvas-open')
  tabChat.classList.add('active')
  tabCanvas?.classList.remove('active')
})

tabCanvas?.addEventListener('click', () => {
  appContent?.classList.add('canvas-open')
  tabCanvas.classList.add('active')
  tabChat?.classList.remove('active')
})
</script>
